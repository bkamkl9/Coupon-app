import{u as k,g as b,_ as w}from"./useLocalStorageFavourite-BJ1AOx3l.js";import{d as C,r as u,o as B,n as I,a as S,c as o,b as d,e as T,F as U,f as E,g as a,h as L,u as v}from"./index-Cd_-fK8T.js";const M={class:"h-[calc(100vh-116px-32px)] overflow-y-auto",id:"coupon-container"},N={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"},O={key:0,class:"flex justify-center items-center p-4"},P={key:1,class:"text-center p-4 text-gray-500"},V={key:2,class:"text-center p-4 text-gray-500"},f=11,A=C({__name:"index",setup(j){const p=b(),{isFavourite:m,handleToggleFavourite:_,isUpdatingFavourite:h,getFavouriteCount:y}=k(),n=u([]),c=u(0),r=u(!1),i=u(!0);let l=null;B(async()=>{await g(),await I(),F()}),S(()=>{l&&l.disconnect()});function F(){const e=document.querySelector("#load-more-sentinel");e&&(l=new IntersectionObserver(t=>{t[0].isIntersecting&&!r.value&&i.value&&g()},{rootMargin:"200px",threshold:.1}),l.observe(e))}async function g(){if(r.value||!i.value)return;r.value=!0;const{data:e,error:t}=await p.from("Coupons").select("*").order("created_at",{ascending:!1}).range(c.value*f,(c.value+1)*f-1);t?console.error(t):(n.value=[...n.value,...e],c.value++,(!e||e.length<f)&&(i.value=!1)),r.value=!1}function x(e){_(e)}return(e,t)=>(a(),o("div",M,[d("div",N,[(a(!0),o(U,null,E(n.value,s=>(a(),o("div",null,[(a(),L(w,{class:"h-full",key:s.id,coupon:s,isFavourite:v(m)(s.id),isUpdatingFavourite:v(h)(s.id),favouriteCount:v(y)(s),onToggleFavourite:x},null,8,["coupon","isFavourite","isUpdatingFavourite","favouriteCount"]))]))),256))]),r.value?(a(),o("div",O,[...t[0]||(t[0]=[d("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"},null,-1)])])):!i.value&&n.value.length>0?(a(),o("div",P," To wszystko, co mamy ")):!i.value&&n.value.length===0?(a(),o("div",V," Brak dostępnych kuponów ")):T("",!0),t[1]||(t[1]=d("div",{id:"load-more-sentinel",class:"h-1"},null,-1))]))}});export{A as default};
